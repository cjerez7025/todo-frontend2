<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-icon">
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
            <rect width="40" height="40" rx="12" fill="url(#gradient1)"/>
            <path d="M10 20L18 28L30 12" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <defs>
              <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#667eea"/>
                <stop offset="100%" style="stop-color:#764ba2"/>
              </linearGradient>
            </defs>
          </svg>
        </div>
        <div class="title-section">
          <h1>{{ title }}</h1>
          <p class="subtitle">Datos en tiempo real desde Google Sheets</p>
        </div>
      </div>
      <div class="header-actions">
        <button (click)="recargarDatos()" class="reload-btn" [disabled]="loading">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" *ngIf="!loading">
            <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="spinner-small" *ngIf="loading"></div>
          <span *ngIf="!loading">Actualizar</span>
          <span *ngIf="loading">Cargando...</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-animation">
      <div class="loading-chart">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <rect x="10" y="50" width="8" height="20" fill="#667eea" rx="4">
            <animate attributeName="height" values="20;40;20" dur="1s" repeatCount="indefinite" begin="0s"/>
            <animate attributeName="y" values="50;30;50" dur="1s" repeatCount="indefinite" begin="0s"/>
          </rect>
          <rect x="25" y="45" width="8" height="30" fill="#764ba2" rx="4">
            <animate attributeName="height" values="30;50;30" dur="1s" repeatCount="indefinite" begin="0.2s"/>
            <animate attributeName="y" values="45;25;45" dur="1s" repeatCount="indefinite" begin="0.2s"/>
          </rect>
          <rect x="40" y="40" width="8" height="40" fill="#f093fb" rx="4">
            <animate attributeName="height" values="40;60;40" dur="1s" repeatCount="indefinite" begin="0.4s"/>
            <animate attributeName="y" values="40;20;40" dur="1s" repeatCount="indefinite" begin="0.4s"/>
          </rect>
          <rect x="55" y="35" width="8" height="50" fill="#f5576c" rx="4">
            <animate attributeName="height" values="50;65;50" dur="1s" repeatCount="indefinite" begin="0.6s"/>
            <animate attributeName="y" values="35;15;35" dur="1s" repeatCount="indefinite" begin="0.6s"/>
          </rect>
        </svg>
      </div>
      <h3>Cargando Dashboard</h3>
      <p>Conectando con Google Sheets...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">
      <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="#e53e3e" stroke-width="2"/>
        <line x1="15" y1="9" x2="9" y2="15" stroke="#e53e3e" stroke-width="2"/>
        <line x1="9" y1="9" x2="15" y2="15" stroke="#e53e3e" stroke-width="2"/>
      </svg>
    </div>
    <h2>Error al cargar datos</h2>
    <p>{{ errorMessage }}</p>
    <button (click)="recargarDatos()" class="retry-btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
        <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Reintentar
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error" class="dashboard-content">
    
    <!-- Navigation -->
    <nav class="dashboard-nav">
      <button 
        [class.active]="vistaActual === 'general'"
        (click)="mostrarVista('general')"
        class="nav-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="9,22 9,12 15,12 15,22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        General
      </button>
      <button 
        [class.active]="vistaActual === 'tendencias'"
        (click)="mostrarVista('tendencias')"
        class="nav-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <polyline points="23,6 13.5,15.5 8.5,10.5 1,18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="17,6 23,6 23,12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Tendencias
      </button>
      <button 
        [class.active]="vistaActual === 'ejecutivos'"
        (click)="mostrarVista('ejecutivos')"
        class="nav-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
          <path d="M20 8v6M23 11l-3 3-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Ejecutivos
      </button>
    </nav>

    <!-- Vista General -->
    <div *ngIf="vistaActual === 'general'" class="vista-general">
      
      <!-- Tarjetas KPI por mes - SIMPLIFICADO -->
      <div *ngIf="resumen && tendencia" class="kpis-container">
        <!-- Sección Ventas -->
        <div class="kpi-section-wrapper">
          <h3 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
            </svg>
            VENTAS APROBADAS POR MES
          </h3>
          <div class="kpi-cards-row">
            <div *ngFor="let mes of tendencia.labels; let i = index" 
                 class="kpi-card-small ventas"
                 [style.background]="getVentasGradient(i)">
              <div class="card-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <div class="card-mes">{{ mes }}</div>
              <div class="card-valor">{{ formatNumber(tendencia.ventas[i]) }}</div>
              <div class="card-cambio" *ngIf="i > 0">
                {{ getVariacion(tendencia.ventas[i], tendencia.ventas[i-1]) }}
              </div>
              <div class="card-cambio" *ngIf="i === 0">Base</div>
            </div>
          </div>
        </div>

        <!-- Sección NAP -->
        <div class="kpi-section-wrapper">
          <h3 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2"/>
            </svg>
            NAP GENERADO POR MES
          </h3>
          <div class="kpi-cards-row">
            <div *ngFor="let mes of tendencia.labels; let i = index" 
                 class="kpi-card-small nap"
                 [style.background]="getNapGradient(i)">
              <div class="card-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2"/>
                  <path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <div class="card-mes">{{ mes }} NAP</div>
              <div class="card-valor">{{ formatNumber(tendencia.nap[i]) }}</div>
              <div class="card-cambio">UF estimado</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen Cards -->
      <div *ngIf="resumen" class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <line x1="18" y1="20" x2="18" y2="10" stroke="currentColor" stroke-width="2"/>
              <line x1="12" y1="20" x2="12" y2="4" stroke="currentColor" stroke-width="2"/>
              <line x1="6" y1="20" x2="6" y2="14" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>Total Ventas</h3>
            <p class="stat-number">{{ formatNumber(resumen.totalVentas) }}</p>
            <small>{{ resumen.mesesProcesados }} meses procesados</small>
          </div>
        </div>
        
        <div class="stat-card success">
          <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" stroke="currentColor" stroke-width="2"/>
              <line x1="3" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2"/>
              <path d="M16 10a4 4 0 0 1-8 0" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>Total NAP</h3>
            <p class="stat-number">{{ formatNumber(resumen.totalNap) }}</p>
            <small>Nuevos Activos Productivos</small>
          </div>
        </div>
        
        <div class="stat-card info">
          <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
              <path d="M7 15h10v-5H7z" fill="currentColor" opacity="0.3"/>
              <path d="M17 9l-5 5-5-5" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>Promedio Mensual</h3>
            <p class="stat-number">{{ formatNumber(resumen.promedioMensualVentas) }}</p>
            <small>ventas por mes</small>
          </div>
        </div>
        
        <div class="stat-card warning">
          <div class="stat-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <polygon points="10,8 16,12 10,16" fill="currentColor"/>
            </svg>
          </div>
          <div class="stat-content">
            <h3>NAP Promedio</h3>
            <p class="stat-number">{{ formatNumber(resumen.promedioMensualNap) }}</p>
            <small>por mes</small>
          </div>
        </div>
      </div>

      <!-- Gráficos -->
      <div class="charts-grid">
        <div class="chart-card">
          <h3>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <polyline points="23,6 13.5,15.5 8.5,10.5 1,18" stroke="currentColor" stroke-width="2"/>
              <polyline points="17,6 23,6 23,12" stroke="currentColor" stroke-width="2"/>
            </svg>
            Ventas por Coordinador
          </h3>
          <div id="coordinadores-chart"></div>
        </div>
        
        <div class="chart-card">
          <h3>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <rect x="3" y="4" width="18" height="15" rx="2" ry="1" stroke="currentColor" stroke-width="2"/>
              <rect x="7" y="12" width="3" height="5" fill="currentColor"/>
              <rect x="13" y="8" width="3" height="9" fill="currentColor"/>
            </svg>
            NAP por Coordinador
          </h3>
          <div id="nap-chart"></div>
        </div>
        
        <div class="chart-card large">
          <h3>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M21.21 15.89A10 10 0 1 1 8 2.83" stroke="currentColor" stroke-width="2"/>
              <path d="M22 12A10 10 0 0 0 12 2v10z" fill="currentColor" opacity="0.3"/>
            </svg>
            Tendencia Mensual
          </h3>
          <div id="tendencia-mensual-chart"></div>
        </div>
        
        <div class="chart-card extra-large">
          <h3>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="6" fill="none" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="2" fill="currentColor"/>
            </svg>
            Distribución por Producto
          </h3>
          <div id="productos-chart"></div>
        </div>
      </div>
    </div>

    <!-- Vista Tendencias -->
    <div *ngIf="vistaActual === 'tendencias'" class="vista-tendencias">
      <div class="chart-card large">
        <h3>📈 Comparativo Trimestral</h3>
        <div id="trimestral-chart"></div>
      </div>
      
      <div *ngIf="tendencia" class="tendencia-detalle">
        <h3>📅 Detalle Mensual 2024</h3>
        <div class="meses-grid">
          <div *ngFor="let mes of tendencia.labels; let i = index" class="mes-card">
            <h4>{{ mes }}</h4>
            <div class="mes-stats">
              <div class="mes-stat">
                <span class="label">Ventas:</span>
                <span class="value">{{ formatNumber(tendencia.ventas[i]) }}</span>
              </div>
              <div class="mes-stat">
                <span class="label">NAP:</span>
                <span class="value">{{ formatNumber(tendencia.nap[i]) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vista Ejecutivos -->
    <div *ngIf="vistaActual === 'ejecutivos'" class="vista-ejecutivos">
      <div *ngIf="topEjecutivos" class="ejecutivos-container">
        <h3>🏆 Top 15 Ejecutivos</h3>
        
        <!-- Top 3 destacados -->
        <div class="podium">
          <div *ngFor="let ejecutivo of topEjecutivos.ejecutivos.slice(0, 3); let i = index" 
               class="podium-item" 
               [ngClass]="'position-' + (i + 1)">
            <div class="medal">{{ i === 0 ? '🥇' : i === 1 ? '🥈' : '🥉' }}</div>
            <h4>{{ ejecutivo.nombre }}</h4>
            <p class="coordinador">{{ ejecutivo.coordinador }}</p>
            <p class="total-ventas">{{ formatNumber(ejecutivo.total) }} ventas</p>
            <p class="promedio">Promedio: {{ ejecutivo.promedio }}</p>
          </div>
        </div>

        <!-- Tabla completa -->
        <div class="tabla-ejecutivos">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Ejecutivo</th>
                <th>Coordinador</th>
                <th>Ene</th>
                <th>Feb</th>
                <th>Mar</th>
                <th>Abr</th>
                <th>May</th>
                <th>Jun</th>
                <th>Jul</th>
                <th>Total</th>
                <th>Promedio</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ejecutivo of topEjecutivos.ejecutivos" 
                  [ngClass]="{'top-3': ejecutivo.posicion <= 3}">
                <td class="posicion">{{ ejecutivo.posicion }}</td>
                <td class="nombre">{{ ejecutivo.nombre }}</td>
                <td class="coordinador">{{ ejecutivo.coordinador }}</td>
                <td>{{ ejecutivo.enero }}</td>
                <td>{{ ejecutivo.febrero }}</td>
                <td>{{ ejecutivo.marzo }}</td>
                <td>{{ ejecutivo.abril }}</td>
                <td>{{ ejecutivo.mayo }}</td>
                <td>{{ ejecutivo.junio }}</td>
                <td>{{ ejecutivo.julio }}</td>
                <td class="total">{{ ejecutivo.total }}</td>
                <td class="promedio">{{ ejecutivo.promedio }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Footer con información -->
    <footer class="dashboard-footer">
      <p *ngIf="resumen">
        📊 Última actualización: {{ resumen.ultimaActualizacion | date:'short' }} | 
        Datos procesados de Google Sheets
      </p>
    </footer>
  </div>
</div>